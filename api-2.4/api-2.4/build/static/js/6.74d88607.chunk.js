(this.webpackJsonpcryptochat=this.webpackJsonpcryptochat||[]).push([[6],{122:function(e,t){},163:function(e,t){},165:function(e,t){},183:function(e,t,c){"use strict";c.r(t);var n=c(178),a=c(22),o=c(0),s=c.n(o),i=c(76),l=c(2),r=c(23),d=c.p+"static/media/notification.e54748d9.mp3",u=c(121),j=c.n(u),b=c(113),p=(c(98),c(101)),h=c.n(p),m=c(99),O=c(87),y=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,n=atob(btoa(e)),a=[],o=0;o<n.length;o+=c){for(var s=n.slice(o,o+c),i=new Array(s.length),l=0;l<s.length;l++)i[l]=s.charCodeAt(l);var r=new Uint8Array(i);a.push(r)}var d=new Blob(a,{type:t});return d};var g={encryptMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=h.a.AES.encrypt(e,t);return c.toString()},decryptMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{var c=h.a.AES.decrypt(e,t),n=c.toString(h.a.enc.Utf8);return n}catch(a){return console.log("Malformed UTF-8 Data."),""}}},f=c(147),v=c(177),x=Object(v.a)(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API),S=c(3),C=c(157);t.default=function(){var e,t=Object(l.f)(),c=Object(o.useRef)(null),u=s.a.useRef(null),p=s.a.useState(null),v=Object(a.a)(p,2),k=v[0],E=v[1],T=s.a.useState(new Audio(d)),R=Object(a.a)(T,1)[0],w=Object(o.useContext)(r.a),_=Object(a.a)(w,2),A=_[0],M=_[1],D=s.a.useState(""),B=Object(a.a)(D,2),L=B[0],N=B[1],P=s.a.useState("faPaperclip"),I=Object(a.a)(P,2),H=I[0],U=I[1],F=s.a.useState(!1),W=Object(a.a)(F,2),K=W[0],V=W[1],Y=s.a.useState(!1),z=Object(a.a)(Y,2),J=z[0],Z=z[1],q=s.a.useState(""),G=Object(a.a)(q,2),Q=G[0],X=G[1],$=s.a.useState(null),ee=Object(a.a)($,2),te=ee[0],ce=ee[1],ne=s.a.useState([]),ae=Object(a.a)(ne,2),oe=ae[0],se=ae[1],ie=s.a.useState(!1),le=Object(a.a)(ie,2),re=le[0],de=le[1],ue=s.a.useState(!1),je=Object(a.a)(ue,2),be=je[0],pe=je[1],he=s.a.useState(!1),me=Object(a.a)(he,2),Oe=me[0],ye=me[1],ge=function(){return ye(!1)},fe=s.a.useState(!1),ve=Object(a.a)(fe,2),xe=ve[0],Se=ve[1];function Ce(e){var t=g.decryptMessage(e.user_name,A.key);if(""!==t){console.log(e),se((function(e){return[].concat(Object(n.a)(e),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("p",{class:"dateTime",children:(new Date).toLocaleString()}),Object(S.jsxs)("b",{title:(new Date).toLocaleString(),children:[" ",t," has joined the room."]})]})})])})),!1===document.hasFocus()&&R.play();try{c.current.scrollIntoView({behavior:"smooth"})}catch(a){return}}else console.log("Not my message: ".concat(e))}function ke(e){E(e.count)}function Ee(e){var t=g.decryptMessage(e.user_name,A.key);if(""!==t){console.log(e),se((function(e){return[].concat(Object(n.a)(e),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("p",{class:"dateTime",children:(new Date).toLocaleString()}),Object(S.jsxs)("b",{title:(new Date).toLocaleString(),children:[" ",t," has left the room."]})]})})])})),!1===document.hasFocus()&&R.play();try{c.current.scrollIntoView({behavior:"smooth"})}catch(a){return}}else console.log("Not my message: ".concat(e))}function Te(e){var t=e.hmac,a=h.a.HmacSHA256(e.message,A.key).toString();if(t!==a)return se((function(e){return[].concat(Object(n.a)(e),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("b",{children:"[DECRYPTION ERROR]"}),": [DECRYPTION ERROR]"]})})])})),console.log("Unable to verify authenticity.\nReceived HMAC: ".concat(t,"\nCalculated HMAC: ").concat(a,"\nReceived message:")),void console.log(e);var o=g.decryptMessage(e.user_name,A.key),s=g.decryptMessage(e.message,A.key);if(""!==o||""!==s){console.log(e),se((function(e){return[].concat(Object(n.a)(e),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("p",{class:"dateTime",children:(new Date).toLocaleString()}),Object(S.jsxs)("b",{title:(new Date).toLocaleString(),children:[" ",o]}),": ",s]})})])}));try{c.current.scrollIntoView({behavior:"smooth"})}catch(i){return}}else se((function(e){return[].concat(Object(n.a)(e),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("b",{children:"[DECRYPTION ERROR]"}),": [DECRYPTION ERROR]"]})})])})),console.log("Not my message: ".concat(e));!1===document.hasFocus()&&R.play()}function Re(e){console.log(e),console.log("[File Handler] file received");var t=e.hmac,a=h.a.HmacSHA256(e.data,A.key).toString();if(t!==a)return se((function(e){return[].concat(Object(n.a)(e),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("b",{children:"[DECRYPTION ERROR]"}),": [DECRYPTION ERROR]"]})})])})),console.log("Unable to verify authenticity.\nReceived HMAC: ".concat(t,"\nCalculated HMAC: ").concat(a,"\nReceived message:")),void console.log(e);var o=g.decryptMessage(e.user_name,A.key),s=g.decryptMessage(e.name,A.key),i=g.decryptMessage(e.type,A.key);if(""!==o)switch(i){case"image/jpeg":case"image/gif":case"image/png":return void se((function(t){return[].concat(Object(n.a)(t),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("p",{class:"dateTime",children:(new Date).toLocaleString()}),Object(S.jsxs)("b",{title:(new Date).toLocaleString(),children:[" ",o," sent an image"]}),".",Object(S.jsxs)("span",{class:"decrypt",onClick:function(){we(e.data,s,i)},children:[" Click to preview ",s,"."]}),Object(S.jsx)("img",{id:s,class:"previewedImage",alt:s,style:{display:"none"}})]})})])}));case"audio/mpeg":case"audio/wav":case"audio/flac":return void se((function(t){return[].concat(Object(n.a)(t),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("p",{class:"dateTime",children:(new Date).toLocaleString()}),Object(S.jsxs)("b",{children:[" ",o," sent an audio file"]}),".",Object(S.jsxs)("span",{class:"decrypt",onClick:function(){we(e.data,s,i)},children:[" Click to preview ",s,"."]}),Object(S.jsx)("br",{}),Object(S.jsx)("audio",{class:"previewedImage",id:s,controls:!0,style:{display:"none"}})]})})])}));case"video/mp4":return void se((function(t){return[].concat(Object(n.a)(t),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("p",{class:"dateTime",children:(new Date).toLocaleString()}),Object(S.jsxs)("b",{children:[" ",o," sent a video"]}),".",Object(S.jsxs)("span",{class:"decrypt",onClick:function(){we(e.data,s,i)},children:[" Click to preview ",s,"."]}),Object(S.jsx)("br",{}),Object(S.jsx)("video",{class:"previewedImage",id:s,controls:!0,style:{display:"none"}})]})})])}));default:se((function(t){return[].concat(Object(n.a)(t),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("p",{class:"dateTime",children:(new Date).toLocaleString()}),Object(S.jsxs)("b",{children:[" ",o," sent an attachment"]}),".",Object(S.jsxs)("span",{class:"decrypt",onClick:function(){!function(e,t,c){var n=g.decryptMessage(e,A.key);console.log("[Decrypt Button] Decrypted Data.\n[DecryptButton] Converting base64 to ".concat(c," blob."));var a=y(atob(n),c);console.log("[Decrypt Button] Blob created."),console.log(a),function(e,t){var c=document.createElement("a");document.body.appendChild(c),c.style="display: none";var n=window.URL.createObjectURL(e);c.href=n,c.download=t,c.click(),window.URL.revokeObjectURL(n)}(a,t)}(e.data,s,i)},children:[" Click to decrypt ",s,"."]})]})})])}))}!1===document.hasFocus()&&R.play();try{c.current.scrollIntoView({behavior:"smooth"})}catch(l){return}}window.onbeforeunload=function(e){(e||window.event).preventDefault(),console.log("[Tab] Close attempt detected."),console.log("[Tab] Broadcasting leave."),x.emit("leave",{roomName:A.roomName,user_name:g.encryptMessage(A.username,A.key)})},Object(o.useEffect)((function(){if(null!==A.key&&null!==A.username){R.volume=.5;var e=h.a.SHA512(A.key).toString();M({type:"SET_ROOM",payload:e}),!1===re&&(x.emit("join",{roomName:e,user_name:g.encryptMessage(A.username,A.key)}),de(!0))}else t.push("/")}),[A.roomName]),Object(o.useEffect)((function(){try{x.on("chat response",Te),x.on("file response",Re),x.on("join response",Ce),x.on("leave response",Ee),x.on("user count",ke)}catch(e){return void t.push("/")}return function(){x.off("chat response"),x.off("file response"),x.off("join response"),x.off("leave response"),x.off("user count")}}),[]);var we=function(e,t,c){var n=document.getElementById(t);if("display: inline-block;"!==n.style.cssText){if(""===n.src){var a=g.decryptMessage(e,A.key);console.log("[Decrypt Button] Decrypted Data.\n[DecryptButton] Converting base64 to ".concat(c," blob."));var o=y(atob(a),c),s=URL.createObjectURL(o);document.getElementById(t).src=s}document.getElementById(t).style="display: inline-block;"}else n.style="display: none;"};function _e(){x.emit("leave",{roomName:A.roomName,user_name:g.encryptMessage(A.username,A.key)})}function Ae(){"light"===A.theme?(e="dark",M({type:"SET_OTHEME",payload:"light"}),M({type:"SET_MODAL",payload:"#292929"})):(e="light",M({type:"SET_OTHEME",payload:"dark"}),M({type:"SET_MODAL",payload:"#b3b3b3"})),M({type:"SET_THEME",payload:e}),document.documentElement.setAttribute("data-theme",e)}function Me(e){var t=g.encryptMessage(e,A.key);x.emit("chat event",{roomName:A.roomName,user_name:g.encryptMessage(A.username,A.key),message:t,hmac:h.a.HmacSHA256(t,A.key).toString()})}function De(){if(console.log("[Send Button] Clicked."),""!==L){if(!0===J){ye(!0),console.log("[Send Button] Attachment mode.");var e=new FileReader;return e.readAsDataURL(te),void(e.onload=function(){e.result.replace(/^data:.+;base64,/,"");var t=e.result.toString().split(",")[1];console.log("[Send Button] Base64 encoded data. Sending ".concat(te.type,"."));var c=g.encryptMessage(A.username,A.key),n=g.encryptMessage(Q.name,A.key),a=g.encryptMessage(te.type,A.key);console.log("[Send Button] Username, file name and file MIME encrypted.");var o=g.encryptMessage(t,A.key),s=h.a.HmacSHA256(o.toString(),A.key).toString();console.log("[Send Button] File data encrypted. Sending...");var i=C.createStream();try{C(x).emit("file event",i,{roomName:A.roomName,user_name:c,name:n,type:a,data:o,hmac:s})}catch(l){return console.log("[Send Button] Couldn't send file."),void ge()}x.on("file progress",(function(e){!0===e.finished&&(console.log("[Send Button] Data sent."),N(""),Z(!1),X(null),ce(null),U("faPaperclip"),pe(!1),ge(),x.off("file progress"))}))})}switch(console.log("[Send Button] Message mode."),L){case"/?":case"/cryptochat":case"/commands":case"/cmds":case"/help":se((function(e){return[].concat(Object(n.a)(e),[Object(S.jsx)("div",{ref:c,children:Object(S.jsxs)("p",{children:[Object(S.jsx)("b",{class:"systemmsg",children:"SYSTEM: Only you can see this help message."}),Object(S.jsx)("br",{}),Object(S.jsx)("b",{children:"CryptoChat Command Help"}),Object(S.jsx)("br",{}),"/theme - Change app theme.",Object(S.jsx)("br",{}),"/shrug - Send a shrug emoticon.",Object(S.jsx)("br",{}),"/tableflip - Send a table flipping emoticon.",Object(S.jsx)("br",{}),"/unflip - Send a table unflipping emoticon.",Object(S.jsx)("br",{}),"/leave - Leave the room."]})})])}));break;case"/quit":case"/bye":case"/exit":case"/leave":_e(),t.push("/");break;case"/shrug":Me("\xaf\\_(\u30c4)_/\xaf");break;case"/tableflip":Me("(\u256f\xb0\u25a1\xb0\uff09\u256f\ufe35 \u253b\u2501\u253b");break;case"/unflip":Me("\u252c\u2500\u252c \u30ce( \u309c-\u309c\u30ce)");break;case"/theme":Ae();break;default:Me(L)}try{c.current.scrollIntoView({behavior:"smooth"})}catch(a){return}N("")}else console.log("[Send Button] Message is empty. Returning.")}return Object(S.jsxs)(s.a.Fragment,{children:[Object(S.jsx)(i.a,{children:Object(S.jsx)("link",{rel:"stylesheet",href:"/styles/Chat.css"})}),Object(S.jsx)("div",{class:"chatbox-parent",id:"chatbox-parent",children:Object(S.jsxs)("div",{class:"chatbox-child",children:[Object(S.jsxs)("div",{class:"chatbox-header",children:[Object(S.jsxs)("p",{class:"keyname title",id:"keyname",title:"This key is used to join your CryptoChat room.",children:["Room Key:",Object(S.jsx)("p",{title:"This key is used to join your CryptoChat room.",class:"keyname",children:A.key}),Object(S.jsx)("p",{class:"copyBtn",children:Object(S.jsx)("button",{class:"copyButton",title:"Copy Roomkey",onClick:function(){if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(A.key),console.log("Copied via https version");else{console.log("navigator.clipboard");var e=document.createElement("textarea");e.value=A.key,e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy");console.log("copied via http ver")}catch(c){f.warning("Was not possible to copy te text: ",c),console.log(c)}document.body.removeChild(e)}var t=document.getElementById("snackbar");t.className="show",setTimeout((function(){t.className=t.className.replace("show","")}),3e3)},children:Object(S.jsx)("span",{children:Object(S.jsx)(m.a,{icon:O.a})})})})]}),Object(S.jsxs)("p",{class:"icon users",title:"Connected Users",children:[Object(S.jsx)(m.a,{icon:O.g})," ",k]}),Object(S.jsx)("h1",{class:"chatbox-title",children:"AATMANIRBHAR-SANCHAR"}),Object(S.jsx)("h2",{class:"chatbox-subtitle",children:"A stunning encrypted chat webapp."})]}),Object(S.jsxs)("div",{class:"chatbox-messages",children:[!0===K&&window.innerWidth<800&&Object(S.jsx)("div",{class:"emojiPicker",children:Object(S.jsx)(j.a,{onEmojiClick:function(e,t){N(L.concat(t.emoji))}})}),Object(S.jsx)("div",{class:"messageviewer-parent",children:Object(S.jsx)("div",{id:"messageviewer",name:"messageviewer",class:"messageviewer",children:Object(S.jsxs)("div",{class:"messagetxt",id:"messagetxt",children:[" ",oe]})})}),Object(S.jsx)("div",{class:"messagebox",children:Object(S.jsxs)("div",{class:"fields",children:[Object(S.jsxs)("div",{class:"username",children:[Object(S.jsxs)("button",{class:"iconbutton attach",title:"Attach a file",onClick:function(e){console.log("[Message Button] Clicked."),"faPaperclip"===H&&!1===J?(console.log("[Message Button] Attachment selection mode."),u.current.click()):"faTimes"===H&&!0===J&&(console.log("[Message Button] Attachment removal mode."),Z(!1),X(null),N(""),pe(!1),U("faPaperclip"))},children:[" ","faPaperclip"===H&&Object(S.jsx)(m.a,{icon:O.e}),"faTimes"===H&&Object(S.jsx)(m.a,{icon:O.f})]}),Object(S.jsx)("input",{id:"msg",type:"text",class:"message",placeholder:"Message",disabled:be?"disabled":"",value:L,onChange:function(e){N(e.target.value)},onKeyDown:function(e){13===e.keyCode&&De()}}),Object(S.jsx)("input",{type:"file",id:"file-input",class:"fileinput",ref:u,onChange:function(e){Z(!0);var t=[];t.push(e.target.files[0]);try{ce(new Blob(t,{type:e.target.files[0].type}))}catch(a){return Z(!1),void ce(null)}var c=e.target.files[0];X(c);var n=c.size/1024e3;if(n>Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SIZE_LIMIT)return Se(!0),Z(!1),ce(null),void X(null);N("Attached: ".concat(c.name," (").concat(n.toFixed(2)," MB)")),pe(!0),U("faTimes")}}),Object(S.jsx)("button",{class:"iconbutton emoji",title:"Open Emoji Picker",onClick:function(){!0!==J&&V(!0!==K)},children:Object(S.jsx)(m.a,{icon:O.d})})]}),!0===K&&window.innerWidth>800&&Object(S.jsx)("div",{class:"emojiPicker",children:Object(S.jsx)(j.a,{disableAutoFocus:"true",native:"true",onEmojiClick:function(e,t){N(L.concat(t.emoji))}})})]})})]}),Object(S.jsxs)("div",{class:"chatbox-buttons",children:[Object(S.jsxs)("button",{class:"button theme",id:"toggler",onClick:Ae,children:[" ",A.oppositeTheme]}),Object(S.jsx)("button",{class:"button send",id:"sendbutton",onClick:De,children:"Send"}),Object(S.jsx)("button",{class:"button leave",id:"leavebutton",onClick:function(){_e(),M({type:"SET_KEY",payload:null}),M({type:"SET_USERNAME",payload:null}),M({type:"SET_ROOM",payload:null}),window.location.reload(),t.push("/")},children:"Leave"})]})]})}),Object(S.jsx)("div",{id:"snackbar",children:"Copied Room Key"}),!0===J&&Object(S.jsxs)(b.a,{style:{backgroundColor:A.modalColor,minWidth:"calc(min(350px,90%))",width:"25%",padding:"2%",textAlign:"center",borderRadius:"10px"},isOpen:Oe,children:[Object(S.jsx)("p",{class:"icon uploading",children:Object(S.jsx)(m.a,{icon:O.c})}),Object(S.jsx)("h1",{children:"Uploading File..."}),Object(S.jsxs)("p",{children:["Please standby while ",Object(S.jsx)("b",{children:Q.name})," is being End-to-End encrypted."]})]}),Object(S.jsxs)(b.a,{style:{backgroundColor:A.modalColor,minWidth:"calc(min(350px,90%))",width:"25%",padding:"2%",textAlign:"center",borderRadius:"10px"},isOpen:xe,children:[Object(S.jsx)("h1",{children:"File Too Large"}),Object(S.jsxs)("p",{children:["The file you selected is larger than the size limit (",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SIZE_LIMIT," MB) and cannot be uploaded."]}),Object(S.jsx)("div",{class:"modalButtons",children:Object(S.jsx)("button",{class:"button",onClick:function(){return Se(!1)},children:"Ok"})})]})]})}}}]);
//# sourceMappingURL=6.74d88607.chunk.js.map